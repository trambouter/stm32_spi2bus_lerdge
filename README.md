# Конвертор SPI для дисплея Lerdge на st7796s

Конвертор SPI шины в 16 битную паралльную шину для работы дисплея от Lerdge на базе контроллера ST7796s
 
Возможна работа на платах с чипом STM32F103C8 или STM32F103C6

[Описание и подключение](https://github.com/trambouter/fb_st7796s_lerdge)

# Что понадобится
[VSCode](https://code.visualstudio.com/)

[PlatformIO](https://platformio.org/)

# Компиляция прошивки

Открываем проект в PlatformIO, по умолчанию сборка для платы STM32F103C8

Если плата STM32C6 то в файле platformio.ini параметре default_envs поменять __bluepill_f103c8__ на __bluepill_f103c6__

# Заливка прошивки

По умолчанию используется протокол stlink для заливки прошивки в контроллер.

Можно залить прошивку и через USB-Uart, [Почитать тут](https://istarik.ru/blog/stm32/111.html)

Для заливки через UART раскоментируйте:
```
upload_protocol = serial
```
# Схема подключения

![](https://github.com/trambouter/fb_st7796s_lerdge/raw/main/images/bluepill_spi.png)

# Особенность подключения сигнала D10

Есть одна особенность - если хотите чтобы диспей работал быстро - желательно припаять провод к резистору R4 - это будет выход контроллера PB2, который не выведен на гребенку контактов. Этот контакт подключается к входу дисплея D10, если использовать такой вариант - то код работает намного быстрее и работу шины SPI спокойно можно разогнать до 30мгц (если разогнать саму stm32 до 112мгц или 124мгц, но на таких частотах замечена нестабильная работа)

![](https://github.com/trambouter/fb_st7796s_lerdge/raw/main/images/Bluepill_R4.jpg)
Если не припаиваться к этому резистору - то выход D10 для дисплея необходимо будет взять с выхода PA1, и в файле __main.c__ раскоментировать строку **GPIOA->BSRR = (RX_D & 0x0004) ? GPIO_BSRR_BS1 : GPIO_BSRR_BR1;**

# Разгон stm32

В файле main.c находим RCC_PLL_MUL9 - и меняем на RCC_PLL_MUL14 (112мгц) или RCC_PLL_MUL16 (124мгц).

